<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Contact Mix-Up: The Investor is Coming</title>

  <style>
    * { box-sizing: border-box; }
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
      font-family: Arial, sans-serif;
      background: #2c3e50;
      color: #333;
    }
    img { max-width: 100%; height: auto; display: block; }

    /* GAME WRAP */
    .game-container {
      width: min(560px, 100%);
      margin: 0 auto;
      padding: 14px;
      background: #f5f5f5;
      border-radius: 16px;
      box-shadow: 0 10px 28px rgba(0,0,0,0.22);
      display: none; /* hidden until Start */
    }

    /* STATUS */
    .status-bar {
      background: #fff;
      border-radius: 16px;
      padding: 14px;
      margin-bottom: 14px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.10);
    }
    .timer {
      font-size: 20px;
      font-weight: bold;
      color: #e74c3c;
      margin-bottom: 10px;
      line-height: 1.2;
    }
    .quality-meter {
      height: 18px;
      background: #ecf0f1;
      border-radius: 999px;
      overflow: hidden;
      margin: 10px 0 8px;
    }
    .quality-fill {
      height: 100%;
      width: 50%;
      background: #27ae60;
      transition: width 0.2s ease;
    }
    .quality-text {
      text-align: center;
      font-size: 13px;
      color: #7f8c8d;
    }

    /* INVESTOR TEXT */
    .investor-text {
      background: #3498db;
      color: #fff;
      padding: 10px 12px;
      border-radius: 12px;
      margin: 0 0 14px;
      font-style: italic;
      display: none;
    }

    /* KITCHEN */
    .kitchen {
      background: #fff;
      border-radius: 16px;
      padding: 14px;
      margin-bottom: 14px;
    }
    .kitchen h3 { margin: 0 0 10px; }
    .pots {
      display: flex;
      gap: 10px;
      justify-content: space-between;
    }
    .pot {
      flex: 1;
      min-width: 0;
      text-align: center;
      padding: 10px;
      background: #f9f9f9;
      border-radius: 12px;
    }
    .pot.need-help {
      border: 2px solid #e74c3c;
      animation: pulse 1s infinite;
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(231,76,60,0.40); }
      70% { box-shadow: 0 0 0 10px rgba(231,76,60,0); }
      100% { box-shadow: 0 0 0 0 rgba(231,76,60,0); }
    }
    .pot-icon {
      display: flex;
      justify-content: center;
      margin-bottom: 6px;
    }
    .pot-icon img {
      width: 64px;
      height: 64px;
      object-fit: cover;
      border-radius: 10px;
      background: #ddd;
    }
    .pot small { color: #7f8c8d; }

    /* CONTACTS */
    h3 { margin: 12px 0 10px; }
    .contacts {
      background: #fff;
      border-radius: 16px;
      overflow: hidden;
      margin-bottom: 14px;
    }
    .contact {
      padding: 14px;
      border-bottom: 1px solid #eee;
      cursor: pointer;
      transition: background 0.15s ease;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    .contact:hover { background: #e3f2fd; }
    .contact:last-child { border-bottom: none; }
    .contact-name { font-weight: bold; margin-bottom: 4px; }
    .contact-preview { font-size: 12px; color: #7f8c8d; }

    /* GROUP CHAT */
    .group-chat {
      background: #fff;
      border-radius: 16px;
      padding: 14px;
      max-height: 220px;
      overflow-y: auto;
      font-size: 13px;
    }
    .group-chat h4 { margin: 0 0 10px; }
    .chat-message {
      margin-bottom: 10px;
      padding: 8px 10px;
      background: #f0f0f0;
      border-radius: 12px;
    }
    .chat-sender { font-weight: bold; color: #2c3e50; margin-bottom: 3px; }
    .chat-text { color: #555; }
    .new-message { animation: highlight 1s; }
    @keyframes highlight {
      0% { background: #fffacd; }
      100% { background: #f0f0f0; }
    }

    /* POPUP (voicemail) */
    .message-popup {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 18px;
      background: rgba(0,0,0,0.45);
      z-index: 3000;
    }
    .message-popup.show { display: flex; }
    .popup-card {
      width: min(380px, 100%);
      background: #fff;
      padding: 16px;
      border-radius: 16px;
      box-shadow: 0 12px 40px rgba(0,0,0,0.35);
    }
    .message-text { margin-bottom: 14px; line-height: 1.45; }
    .message-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .btn {
      padding: 10px 14px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: bold;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    .btn-primary { background: #27ae60; color: #fff; }
    .btn-secondary { background: #e74c3c; color: #fff; }
    .btn-small { background: #3498db; color: #fff; padding: 8px 12px; font-size: 14px; }

    /* HOW TO PLAY overlay (fixed + scrollable + clickable) */
    #how-to-play {
      position: fixed;
      inset: 0;
      background: #1a2634;
      color: #f5f5f5;
      display: flex;
      flex-direction: column;
      padding: 16px;
      z-index: 5000;
      pointer-events: auto;
    }
    .how-inner {
      width: min(680px, 100%);
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 12px;
      flex: 1;
      overflow: auto; /* this is the key fix */
      padding-bottom: 12px;
    }
    .how-title {
      font-size: clamp(1.6rem, 4.8vw, 2.2rem);
      margin: 0;
      color: #e67e22;
      line-height: 1.15;
      text-align: center;
    }
    .how-body {
      width: min(560px, 100%);
      margin: 0 auto;
      font-size: 1rem;
      line-height: 1.6;
    }
    .how-body ul {
      margin: 12px 0 0;
      padding-left: 20px;
      list-style-type: square;
    }
    .how-footer {
      width: min(560px, 100%);
      margin: 0 auto;
      display: flex;
      justify-content: center;
      padding: 8px 0 4px;
    }
    #start-game-btn {
      font-size: 1.15rem;
      padding: 14px 22px;
      border-radius: 14px;
    }

    @media (max-width: 380px) {
      .pots { gap: 8px; }
      .pot-icon img { width: 56px; height: 56px; }
      .timer { font-size: 18px; }
    }
  </style>
</head>

<body>

  <!-- HOW TO PLAY OVERLAY -->
  <div id="how-to-play" role="dialog" aria-modal="true">
    <div class="how-inner">
      <h1 class="how-title">Contact Mix-Up:<br/>The Investor is Coming! üç≤üìû</h1>

      <div class="how-body">
        <p>
          Your investor (Mr. Okafor) arrives soon expecting a proper Naija spread ‚Äî
          but your phone contacts are completely scrambled.
        </p>
        <p>
          <strong>Goal:</strong> Identify <strong>family vs not-family</strong> fast so the right helpers can
          rescue your Jollof, Egusi, and Fufu before quality tanks.
        </p>

        <ul>
          <li>Tap any contact ‚Üí listen to voicemail</li>
          <li>‚úÖ <strong>Save as Family</strong> if it‚Äôs family</li>
          <li>‚ùå <strong>Not Family</strong> if it‚Äôs restaurant / wrong number</li>
          <li>Correct choice boosts quality; key family can help a dish</li>
          <li>Wrong choice drops quality + group chat gets suspicious</li>
          <li><strong>Hanging up</strong> wastes time <em>and</em> reduces quality</li>
        </ul>

        <p style="font-weight:bold; color:#e74c3c; margin-top: 14px;">
          Don‚Äôt burn the food. Don‚Äôt make Aunty angry. Good luck!
        </p>

        <p style="opacity:0.9; margin-top: 12px;">
          <strong>Image fix:</strong> This game expects your files here:
          <code>images/jollof.jpg</code>, <code>images/egusi.jpg</code>, <code>images/fufu.jpg</code>.
        </p>
      </div>

      <div class="how-footer">
        <button id="start-game-btn" class="btn btn-primary" type="button">
          Start Cooking ‚Äì No Time to Waste! üî•
        </button>
      </div>
    </div>
  </div>

  <!-- GAME -->
  <div class="game-container" id="game-container">
    <div class="status-bar">
      <div class="timer">‚è∞ Investor arrives in: <span id="timer">6:00</span></div>
      <div class="quality-meter">
        <div class="quality-fill" id="quality-fill" style="width:50%"></div>
      </div>
      <div class="quality-text">Dish Quality: <span id="quality">50</span>%</div>
    </div>

    <div class="investor-text" id="investor-text"></div>

    <div class="kitchen">
      <h3>üî• Your Kitchen</h3>
      <div class="pots">
        <div class="pot need-help" id="pot-jollof">
          <div class="pot-icon"><img id="img-jollof" alt="Jollof Rice"></div>
          <div><strong>Jollof Rice</strong></div>
          <small>Needs Mom</small>
        </div>

        <div class="pot need-help" id="pot-egusi">
          <div class="pot-icon"><img id="img-egusi" alt="Egusi Soup"></div>
          <div><strong>Egusi Soup</strong></div>
          <small>Needs Aunt</small>
        </div>

        <div class="pot need-help" id="pot-fufu">
          <div class="pot-icon"><img id="img-fufu" alt="Fufu"></div>
          <div><strong>Fufu</strong></div>
          <small>Needs Uncle</small>
        </div>
      </div>
    </div>

    <h3>üì± Mixed Up Contacts</h3>
    <div class="contacts" id="contacts-list"></div>

    <div class="group-chat" id="group-chat">
      <h4>üí¨ Omo Naija Family</h4>
      <div id="chat-messages">
        <div class="chat-message">
          <div class="chat-sender">Cousin:</div>
          <div class="chat-text">Anyone heard from [You] today?</div>
        </div>
      </div>
    </div>
  </div>

  <!-- VOICEMAIL POPUP -->
  <div class="message-popup" id="message-popup" role="dialog" aria-modal="true">
    <div class="popup-card">
      <div class="message-text" id="message-text">Voicemail plays...</div>

      <div class="message-buttons">
        <button class="btn btn-primary" id="btn-fix" type="button">‚úÖ Save as Family</button>
        <button class="btn btn-secondary" id="btn-wrong" type="button">‚ùå Not Family</button>
      </div>

      <div style="text-align:center; margin-top: 10px;">
        <button class="btn btn-small" id="btn-hangup" type="button">üìû Hang Up (Do Nothing)</button>
      </div>
    </div>
  </div>

  <script>
    // Image paths based on your repo structure:
    // images/egusi.jpg, images/fufu.jpg, images/jollof.jpg
    const IMAGE_PATHS = {
      jollof: "images/jollof.jpg",
      egusi:  "images/egusi.jpg",
      fufu:   "images/fufu.jpg",
    };

    const gameState = {
      running: false,
      timerSeconds: 6 * 60, // 6 minutes
      quality: 50,
      mistakes: 0,
      currentCallId: null,
      intervalId: null,

      contacts: [
        { id: "c1",  displayName: "‚ù§Ô∏è Mom",            realIdentity: "restaurant", voicemail: "Thank you for calling Jollof Palace, home of the best jollof in the city! We're open 11am to 10pm.", type: "restaurant", knownAs: null },
        { id: "c2",  displayName: "üë® Dad",            realIdentity: "uncle",      voicemail: "My person! This is Uncle! You caught me at a bad time, I'm eating. Leave message!", type: "family", knownAs: null },
        { id: "c3",  displayName: "üå∏ Aunt",           realIdentity: "mom",        voicemail: "Hello? ... Oh, it's you! Why you no call me yesterday? I made your favorite. Anyway, leave message. Or better, come eat. Love you.", type: "family", knownAs: null },
        { id: "c4",  displayName: "üë¥ Uncle",          realIdentity: "aunt",       voicemail: "Eh! Who this? ... Oh, voicemail. This is Aunty. If you're my real family, leave message. If you're selling something, God punish you.", type: "family", knownAs: null },
        { id: "c5",  displayName: "‚≠ê Cousin",         realIdentity: "cousin",     voicemail: "Yo, it's your favorite cousin! Leave a message, I got you. Unless you're asking for money. Then I'm busy.", type: "family", knownAs: null },
        { id: "c6",  displayName: "üçΩÔ∏è Jollof Palace", realIdentity: "restaurant", voicemail: "Jollof Palace! Today's special: jollof rice with grilled chicken.", type: "restaurant", knownAs: null },
        { id: "c7",  displayName: "üçΩÔ∏è Mama Put",      realIdentity: "restaurant", voicemail: "Mama Put! Where the food is always ready! We open at noon.", type: "restaurant", knownAs: null },
        { id: "c8",  displayName: "üçΩÔ∏è Buka Kitchen",  realIdentity: "dad",        voicemail: "This is Dad. If it's important, I'll call back. If it's your mother, she's in the kitchen.", type: "family", knownAs: null },
        { id: "c9",  displayName: "üçï Pizza Place",    realIdentity: "wrong",      voicemail: "Domino's Pizza! Would you like to place an order? Call back for delivery!", type: "wrong", knownAs: null },
        { id: "c10", displayName: "üíº Kehinde (Work)", realIdentity: "wrong",      voicemail: "Hey, it's Kehinde from work! Haven't heard from you in months! Call me back!", type: "wrong", knownAs: null }
      ],

      familyHelps: {
        mom:   { dish: "jollof", boostGiven: false },
        aunt:  { dish: "egusi",  boostGiven: false },
        uncle: { dish: "fufu",   boostGiven: false }
      }
    };

    const $ = (id) => document.getElementById(id);
    const clamp = (n, min, max) => Math.max(min, Math.min(max, n));

    function formatTime(totalSeconds) {
      const m = Math.floor(totalSeconds / 60);
      const s = totalSeconds % 60;
      return `${m}:${s < 10 ? "0" : ""}${s}`;
    }

    function setQuality(newQuality) {
      gameState.quality = clamp(newQuality, 0, 100);
      $("quality").innerText = gameState.quality;
      $("quality-fill").style.width = gameState.quality + "%";
    }

    function showInvestorText(message) {
      const box = $("investor-text");
      box.innerText = "üì± " + message;
      box.style.display = "block";
      clearTimeout(showInvestorText._t);
      showInvestorText._t = setTimeout(() => {
        box.style.display = "none";
      }, 6500);
    }

    function addGroupChatMessage(sender, message) {
      const chatDiv = $("chat-messages");
      const newMsg = document.createElement("div");
      newMsg.className = "chat-message new-message";
      newMsg.innerHTML = `<div class="chat-sender">${sender}:</div><div class="chat-text">${message}</div>`;
      chatDiv.appendChild(newMsg);

      const container = $("group-chat");
      container.scrollTop = container.scrollHeight;

      setTimeout(() => newMsg.classList.remove("new-message"), 900);
    }

    function checkGameStatus() {
      if (gameState.quality <= 0) {
        endGame("‚ùå GAME OVER - Food ruined. Family disappointed.");
        return;
      }
      if (gameState.quality <= 20) {
        addGroupChatMessage("System", "‚ö†Ô∏è Food almost ruined! Move fast!");
      }
    }

    function endGame(message) {
      gameState.running = false;
      if (gameState.intervalId) clearInterval(gameState.intervalId);
      gameState.intervalId = null;
      alert(message);
    }

    function updateTimer() {
      if (!gameState.running) return;

      if (gameState.timerSeconds <= 0) {
        $("timer").innerText = "0:00";
        endGame("INVESTOR ARRIVES! Your food is not ready...");
        return;
      }

      gameState.timerSeconds -= 1;
      $("timer").innerText = formatTime(gameState.timerSeconds);

      // Spread these across a 6-minute game:
      if (gameState.timerSeconds === 5 * 60 + 15) showInvestorText("Mr. Okafor: Traffic is light. I might be early!");
      if (gameState.timerSeconds === 3 * 60 + 45) showInvestorText("Mr. Okafor: I saw your mother at the market. She didn't mention you were cooking today...");
      if (gameState.timerSeconds === 2 * 60 + 15) showInvestorText("Mr. Okafor: Your father just called me. He asked how your cooking was coming along. I didn't know what to say.");
      if (gameState.timerSeconds === 45)          showInvestorText("Mr. Okafor: I'm 45 seconds out. Hope everything is ready!");
    }

    function getContactById(id) {
      return gameState.contacts.find(c => c.id === id) || null;
    }

    function renderContacts() {
      const list = $("contacts-list");
      list.innerHTML = "";

      const sorted = [...gameState.contacts].sort((a, b) => {
        if (a.knownAs && !b.knownAs) return -1;
        if (!a.knownAs && b.knownAs) return 1;
        return 0;
      });

      for (const c of sorted) {
        const item = document.createElement("div");
        item.className = "contact";
        item.dataset.contactId = c.id;

        const name = c.knownAs ? `‚úÖ ${c.knownAs}` : c.displayName;
        item.innerHTML = `
          <div class="contact-name">${name}</div>
          <div class="contact-preview">Tap to call...</div>
        `;
        list.appendChild(item);
      }
    }

    function openPopup(contactId) {
      const contact = getContactById(contactId);
      if (!contact) return;

      gameState.currentCallId = contactId;
      $("message-text").innerText = "üìû Voicemail: " + contact.voicemail;

      // generic labels (your preference)
      $("btn-fix").innerText = "‚úÖ Save as Family";
      $("btn-wrong").innerText = "‚ùå Not Family";

      $("message-popup").classList.add("show");
    }

    function closePopup() {
      $("message-popup").classList.remove("show");
      gameState.currentCallId = null;
    }

    function applyFamilyHelpIfAny(realIdentityLower) {
      const help = gameState.familyHelps[realIdentityLower];
      if (!help || help.boostGiven) return { helped: false, dish: null };

      help.boostGiven = true;
      const dish = help.dish;

      const pot = $("pot-" + dish);
      if (pot) {
        pot.classList.remove("need-help");
        const small = pot.querySelector("small");
        if (small) small.innerText = "Helped by " + realIdentityLower.charAt(0).toUpperCase() + realIdentityLower.slice(1);
      }
      return { helped: true, dish };
    }

    function onSaveAsFamily() {
      const contact = getContactById(gameState.currentCallId);
      if (!contact) return;

      let qualityDelta = 0;
      let msg = "";

      if (contact.type === "family") {
        // Correct: family
        msg = "‚úÖ Contact saved! You now know this is family.";
        qualityDelta += 12;

        // mark known
        if (!contact.knownAs) {
          const label = contact.realIdentity.charAt(0).toUpperCase() + contact.realIdentity.slice(1);
          contact.knownAs = label;
          renderContacts();
        }

        // dish help for mom/aunt/uncle
        const idLower = String(contact.realIdentity).toLowerCase();
        const helpResult = applyFamilyHelpIfAny(idLower);
        if (helpResult.helped) {
          qualityDelta += 18;
          msg += ` ${contact.knownAs} is helping with ${helpResult.dish}!`;
        }
      } else {
        // Wrong: not family
        gameState.mistakes++;
        qualityDelta -= (gameState.mistakes <= 3) ? 6 : 15;
        msg = "‚ùå That's not family! Wasted time.";
      }

      setQuality(gameState.quality + qualityDelta);
      addGroupChatMessage("System", msg);

      closePopup();
      checkGameStatus();
    }

    function onNotFamily() {
      const contact = getContactById(gameState.currentCallId);
      if (!contact) return;

      let qualityDelta = 0;
      let msg = "";

      if (contact.type === "restaurant" || contact.type === "wrong") {
        // Correct: not family
        msg = "‚úÖ Good call ‚Äî that's not family.";
        qualityDelta += 5;
      } else {
        // Wrong: it was family
        gameState.mistakes++;
        qualityDelta -= (gameState.mistakes <= 3) ? 8 : 20;
        msg = `‚ùå That WAS family! Hung up on your ${contact.realIdentity}.`;

        const sender = contact.realIdentity.charAt(0).toUpperCase() + contact.realIdentity.slice(1);
        addGroupChatMessage(sender, "Did you just call and insult me with hang up??");
      }

      setQuality(gameState.quality + qualityDelta);
      addGroupChatMessage("System", msg);

      closePopup();
      checkGameStatus();
    }

    function onHangUp() {
      // Penalize hang-up (you asked for this)
      addGroupChatMessage("System", "üìû Hung up without leaving message.");
      gameState.timerSeconds = Math.max(0, gameState.timerSeconds - 2);
      $("timer").innerText = formatTime(gameState.timerSeconds);

      setQuality(gameState.quality - 2);

      closePopup();
      checkGameStatus();
    }

    function loadImages() {
      const imgJ = $("img-jollof");
      const imgE = $("img-egusi");
      const imgF = $("img-fufu");

      imgJ.src = IMAGE_PATHS.jollof;
      imgE.src = IMAGE_PATHS.egusi;
      imgF.src = IMAGE_PATHS.fufu;

      // If the path is wrong, show a visible hint instead of silently failing
      const onErr = (which, src) => {
        addGroupChatMessage("System", `‚ö†Ô∏è Could not load image: ${src}. Check file path/case.`);
        const el = $(which);
        if (el) el.alt = "Image missing";
      };

      imgJ.onerror = () => onErr("img-jollof", IMAGE_PATHS.jollof);
      imgE.onerror = () => onErr("img-egusi", IMAGE_PATHS.egusi);
      imgF.onerror = () => onErr("img-fufu", IMAGE_PATHS.fufu);
    }

    function startGame() {
      // hide overlay, show game
      $("how-to-play").style.display = "none";
      $("game-container").style.display = "block";

      // init visuals
      gameState.running = true;
      $("timer").innerText = formatTime(gameState.timerSeconds);
      setQuality(gameState.quality);

      loadImages();
      renderContacts();

      // start timer (real seconds)
      gameState.intervalId = setInterval(updateTimer, 1000);

      // Delayed chat messages (same vibe as your original)
      setTimeout(() => addGroupChatMessage("Aunt", "My phone acting up. Weird calls."), 10_000);
      setTimeout(() => addGroupChatMessage("Uncle", 'Same! Got call from "Jollof Palace". Hung up!'), 20_000);
      setTimeout(() => addGroupChatMessage("Mom", "Wait... [You] called but hung up. Cooking maybe?"), 35_000);
      setTimeout(() => addGroupChatMessage("Dad", "Mr. Okafor called. Going to [You]‚Äôs place. Nobody told me."), 50_000);
      setTimeout(() => {
        addGroupChatMessage("Mom", "WHAT?! Nobody tells me anything!");
        addGroupChatMessage("Aunt", "Eh! [You] better call me NOW!");
      }, 55_000);
    }

    /* --------- Wire up events (reliable on mobile) --------- */

    // Start button
    $("start-game-btn").addEventListener("click", startGame);

    // Contacts list (event delegation)
    $("contacts-list").addEventListener("click", (e) => {
      const item = e.target.closest(".contact");
      if (!item) return;
      const id = item.dataset.contactId;
      openPopup(id);
    });

    // Popup buttons
    $("btn-fix").addEventListener("click", onSaveAsFamily);
    $("btn-wrong").addEventListener("click", onNotFamily);
    $("btn-hangup").addEventListener("click", onHangUp);

    // Tap outside popup card to close (optional, but nice)
    $("message-popup").addEventListener("click", (e) => {
      const card = e.target.closest(".popup-card");
      if (!card) closePopup();
    });
  </script>

</body>
</html>
